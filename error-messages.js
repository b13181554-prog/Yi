/**
 * ุชุญุณูู ุฑุณุงุฆู ุงูุฃุฎุทุงุก ูููุณุชุฎุฏููู
 * Improved Error Messages for Users
 * 
 * ูููุฑ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ ุจุฏูุงู ูู ุงูุฑุณุงุฆู ุงูุชูููุฉ
 */

class ErrorMessages {
  /**
   * ุงูุญุตูู ุนูู ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
   */
  static getUserFriendlyError(error, context = {}) {
    const errorMessage = error?.message || error?.toString() || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู';
    
    // ุฃุฎุทุงุก ุฌูุจ ุจูุงูุงุช ุงูุนููุงุช
    if (errorMessage.includes('ูุดู ูู ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุดููุน')) {
      const symbol = context.symbol || 'ุงูุนููุฉ';
      return {
        title: '๐ ุจูุงูุงุช ุบูุฑ ูุชููุฑุฉ',
        message: `ุนุฐุฑุงูุ ูุง ูููููุง ุงูุญุตูู ุนูู ุจูุงูุงุช ${symbol} ูู ุงูููุช ุงูุญุงูู.\n\n` +
                 `๐ก <b>ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:</b>\n` +
                 `โข ุงูุนููุฉ ูุฏ ูุง ุชููู ูุชููุฑุฉ ุนูู ููุตุงุช ุงูุชุฏุงูู ุงูุฑุฆูุณูุฉ\n` +
                 `โข ูุฏ ุชููู ุนููุฉ ูุงุฏุฑุฉ ุฃู ุฌุฏูุฏุฉ\n` +
                 `โข ูุดููุฉ ูุคูุชุฉ ูู ุงูุงุชุตุงู ุจุงููุตุงุฏุฑ\n\n` +
                 `๐ <b>ุงูุญููู ุงูููุชุฑุญุฉ:</b>\n` +
                 `โข ุฌุฑุจ ุนููุฉ ุฃุฎุฑู ุฃูุซุฑ ุดูุฑุฉ (ูุซู BTC, ETH)\n` +
                 `โข ุญุงูู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ูููู\n` +
                 `โข ุชุฃูุฏ ูู ูุชุงุจุฉ ุฑูุฒ ุงูุนููุฉ ุจุดูู ุตุญูุญ`,
        canRetry: true,
        severity: 'warning'
      };
    }
    
    // ุฃุฎุทุงุก ุชุญููู AI
    if (errorMessage.includes('ูุดู ุชุญููู AI') || 
        errorMessage.includes('capacity') || 
        errorMessage.includes('rate limit')) {
      return {
        title: '๐ค ุฎุฏูุฉ ุงูุชุญููู ุงูุฐูู ูุดุบููุฉ',
        message: `ุนุฐุฑุงูุ ุฎุฏูุฉ ุงูุชุญููู ุงูุฐูู ุบูุฑ ูุชุงุญุฉ ุญุงููุงู.\n\n` +
                 `๐ก <b>ุงูุณุจุจ:</b>\n` +
                 `โข ุชู ุชุฌุงูุฒ ุงูุญุฏ ุงููุณููุญ ูู ุงูุทูุจุงุช\n` +
                 `โข ุงูุฎุฏูุฉ ุชุญุช ุถุบุท ูุจูุฑ\n\n` +
                 `๐ <b>ูุง ููููู ูุนูู:</b>\n` +
                 `โข ุงุณุชุฎุฏู ุงูุชุญููู ุงูููู ุงูุนุงุฏู ุจุฏูู AI\n` +
                 `โข ุญุงูู ูุฑุฉ ุฃุฎุฑู ุจุนุฏ 5-10 ุฏูุงุฆู\n` +
                 `โข ุงูุชุญููู ุงูููู ุงูุฃุณุงุณู ูุง ูุฒุงู ูุชุงุญุงู`,
        canRetry: true,
        severity: 'info'
      };
    }
    
    // ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
    if (errorMessage.includes('database') || 
        errorMessage.includes('MongoDB') ||
        errorMessage.includes('connection')) {
      return {
        title: '๐ง ุฎุทุฃ ุชููู ูุคูุช',
        message: `ููุงุฌู ูุดููุฉ ุชูููุฉ ูุคูุชุฉ.\n\n` +
                 `๐๏ธ <b>ูุง ูุญุฏุซ:</b>\n` +
                 `โข ูุดููุฉ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช\n` +
                 `โข ูุชู ุงูุนูู ุนูู ุญููุง ุชููุงุฆูุงู\n\n` +
                 `โณ <b>ูุฑุฌู:</b>\n` +
                 `โข ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุฏูููุฉ\n` +
                 `โข ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุชูุงุตู ูุน ุงูุฏุนู`,
        canRetry: true,
        severity: 'error'
      };
    }
    
    // ุฃุฎุทุงุก ุงูุดุจูุฉ
    if (errorMessage.includes('timeout') || 
        errorMessage.includes('ETIMEDOUT') ||
        errorMessage.includes('ECONNREFUSED')) {
      return {
        title: '๐ ูุดููุฉ ูู ุงูุงุชุตุงู',
        message: `ุนุฐุฑุงูุ ูู ูุชููู ูู ุงููุตูู ุฅูู ุงูุฎุฏูุฉ.\n\n` +
                 `๐ก <b>ุงูุณุจุจ ุงููุญุชูู:</b>\n` +
                 `โข ูุดููุฉ ูุคูุชุฉ ูู ุงูุฅูุชุฑูุช\n` +
                 `โข ุงูุฎุฏูุฉ ุงูุฎุงุฑุฌูุฉ ุบูุฑ ูุชุงุญุฉ ูุคูุชุงู\n\n` +
                 `๐ <b>ูุฑุฌู:</b>\n` +
                 `โข ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ุงูุขู\n` +
                 `โข ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุฌุฑุจ ุจุนุฏ ูููู`,
        canRetry: true,
        severity: 'warning'
      };
    }
    
    // ุฃุฎุทุงุก ุงููุญูุธุฉ ูุงููุฏููุนุงุช
    if (errorMessage.includes('insufficient') || errorMessage.includes('ุฑุตูุฏ')) {
      return {
        title: '๐ฐ ุฑุตูุฏ ุบูุฑ ูุงูู',
        message: `ุฑุตูุฏู ุงูุญุงูู ุบูุฑ ูุงูู ูุฅุชูุงู ูุฐู ุงูุนูููุฉ.\n\n` +
                 `๐ก <b>ูุฅุชูุงู ุงูุนูููุฉ:</b>\n` +
                 `โข ุงุดุญู ุฑุตูุฏู ุนุจุฑ ูุณู ุงููุญูุธุฉ\n` +
                 `โข ุชุญูู ูู ุฑุตูุฏู ุงูุญุงูู`,
        canRetry: false,
        severity: 'warning'
      };
    }
    
    // ุฃุฎุทุงุก ุตูุงุญูุงุช ุงููุตูู
    if (errorMessage.includes('unauthorized') || 
        errorMessage.includes('forbidden') ||
        errorMessage.includes('ุบูุฑ ูุตุฑุญ')) {
      return {
        title: '๐ ุตูุงุญูุฉ ุบูุฑ ูุชููุฑุฉ',
        message: `ุนุฐุฑุงูุ ููุณ ูุฏูู ุตูุงุญูุฉ ูููุตูู ุฅูู ูุฐู ุงูููุฒุฉ.\n\n` +
                 `๐ก <b>ููุญุตูู ุนูู ุงูุตูุงุญูุฉ:</b>\n` +
                 `โข ูุฏ ุชุญุชุงุฌ ุฅูู ุชุฑููุฉ ุญุณุงุจู\n` +
                 `โข ุชูุงุตู ูุน ุงูุฏุนู ูููุฒูุฏ ูู ุงููุนูููุงุช`,
        canRetry: false,
        severity: 'info'
      };
    }
    
    // ุฃุฎุทุงุก Forex
    if (errorMessage.includes('forex') && errorMessage.includes('ูุดู')) {
      const pair = context.symbol || 'ุงูุฒูุฌ';
      return {
        title: '๐ ุจูุงูุงุช ุงูููุฑูุณ ุบูุฑ ูุชููุฑุฉ',
        message: `ุนุฐุฑุงูุ ูุง ูููููุง ุงูุญุตูู ุนูู ุจูุงูุงุช ${pair}.\n\n` +
                 `๐ก <b>ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:</b>\n` +
                 `โข ุงูุณูู ูุบูู ุญุงููุงู (ุนุทูุฉ ููุงูุฉ ุงูุฃุณุจูุน)\n` +
                 `โข ุงูุฒูุฌ ูุฏ ูุง ูููู ูุชุงุญุงู\n` +
                 `โข ูุดููุฉ ูุคูุชุฉ ูู ุงููุตุฏุฑ\n\n` +
                 `๐ <b>ุงูุญููู:</b>\n` +
                 `โข ุฌุฑุจ ุฃุฒูุงุฌ ุฑุฆูุณูุฉ (EUR/USD, GBP/USD)\n` +
                 `โข ุญุงูู ุฎูุงู ุณุงุนุงุช ุงูุชุฏุงูู\n` +
                 `โข ุชุญูู ูู ุฑูุฒ ุงูุฒูุฌ`,
        canRetry: true,
        severity: 'warning'
      };
    }
    
    // ุฎุทุฃ ุนุงู ูุน ุฑุณุงูุฉ ูุงุถุญุฉ
    return {
      title: 'โ๏ธ ุญุฏุซ ุฎุทุฃ',
      message: `ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน.\n\n` +
               `๐ <b>ุงูุชูุงุตูู:</b> ${errorMessage}\n\n` +
               `๐ <b>ูุฑุฌู:</b>\n` +
               `โข ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู\n` +
               `โข ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุชูุงุตู ูุน ุงูุฏุนู`,
      canRetry: true,
      severity: 'error'
    };
  }
  
  /**
   * ุชูุณูู ุฑุณุงูุฉ ุฎุทุฃ ููุฅุฑุณุงู
   */
  static formatErrorForTelegram(error, context = {}) {
    const errorInfo = this.getUserFriendlyError(error, context);
    
    const emoji = {
      'error': '๐จ',
      'warning': 'โ๏ธ',
      'info': 'โน๏ธ'
    }[errorInfo.severity] || 'โ๏ธ';
    
    let message = `${emoji} <b>${errorInfo.title}</b>\n\n${errorInfo.message}`;
    
    if (errorInfo.canRetry) {
      message += `\n\n๐ ููููู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู`;
    }
    
    return message;
  }
  
  /**
   * ุฑุณุงุฆู ูุฌุงุญ ูุญุณููุฉ
   */
  static getSuccessMessage(action, data = {}) {
    switch (action) {
      case 'analysis_complete':
        return `โ <b>ุชู ุงูุชุญููู ุจูุฌุงุญ!</b>\n\n` +
               `๐ ุชู ุชุญููู ${data.symbol || 'ุงูุฃุตู'} ุจูุฌุงุญ`;
               
      case 'data_fetched':
        return `โ ุชู ุฌูุจ ุงูุจูุงูุงุช ุจูุฌุงุญ\n\n` +
               `๐ ุฌุงูุฒ ููุชุญููู`;
               
      case 'payment_received':
        return `โ <b>ุชู ุงุณุชูุงู ุงูุฏูุน!</b>\n\n` +
               `๐ฐ ุชู ุฅุถุงูุฉ ${data.amount || '0'} USDT ุฅูู ุฑุตูุฏู`;
               
      default:
        return `โ ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ`;
    }
  }
}

module.exports = ErrorMessages;
