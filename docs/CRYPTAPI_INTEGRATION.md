# ุชูุงูู CryptAPI ููุธุงู ุงูุฏูุน

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุงุณุชุจุฏุงู ูุธุงู ุงูุฏูุน ุงููุฏูู (ุงูุฐู ูุงู ูุนุชูุฏ ุนูู ุงูุชุญูู ุงููุฏูู ูู ูุนุงููุงุช TRON) ุจูุธุงู **CryptAPI** ุงูุฃูุซุฑ ุงุญุชุฑุงููุฉ ูุฃุชูุชุฉ.

## ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ

โ **ุฅูุดุงุก ุนููุงู ุฏูุน ูุฑูุฏ** ููู ูุนุงููุฉ ุชููุงุฆููุง  
โ **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ** ุนูุฏ ุงุณุชูุงู ุงูุฏูุนุงุช  
โ **ุฏุนู USDT** ุนูู ุดุจูุฉ TRC-20  
โ **ุฑุณูู ููุฎูุถุฉ** - 1% ููุท ูู ูููุฉ ุงููุนุงููุฉ  
โ **ูุง ูุญุชุงุฌ ุชุณุฌูู** - ููุท ุนููุงู ูุญูุธุชู  

## ููู ูุนูู ุงููุธุงู

### 1. ุฅูุดุงุก ุนููุงู ุงูุฏูุน
ุนูุฏูุง ูุฑูุฏ ุงููุณุชุฎุฏู ุงูุฅูุฏุงุน:
- ูุทูุจ Web App ุนููุงู ุฏูุน ุฌุฏูุฏ ูู `/api/cryptapi/create-payment`
- ูุชู ุฅูุดุงุก ุนููุงู USDT TRC-20 ูุฑูุฏ ูููุณุชุฎุฏู
- ูุชู ุญูุธ ูุนูููุงุช ุงูุฏูุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุชู ุฅุฑุฌุงุน ุงูุนููุงู + QR Code ูููุณุชุฎุฏู

### 2. ุงูุฏูุน
- ุงููุณุชุฎุฏู ูุฑุณู USDT ุฅูู ุงูุนููุงู ุงููููุดุฃ
- CryptAPI ูุฑุงูุจ ุงูุนููุงู ุชููุงุฆููุง

### 3. ุงูุฅุดุนุงุฑ ุงูุชููุงุฆู (Callback)
- ุนูุฏูุง ูุชู ุงุณุชูุงู ุงูุฏูุนุ CryptAPI ูุฑุณู callback ุฅูู `/api/cryptapi/callback`
- ุงููุธุงู ูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ูุชู ุชุญุฏูุซ ุฑุตูุฏ ุงููุณุชุฎุฏู ุชููุงุฆููุง
- ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู ูุงููุงูู

## ุงููููุงุช ุงูููุถุงูุฉ/ุงูููุนุฏููุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
- `cryptapi.js` - ุฎุฏูุฉ ุงูุชูุงูู ูุน CryptAPI

### ูููุงุช ูุนุฏูุฉ:
- `config.js` - ุฅุถุงูุฉ `CRYPTAPI_CALLBACK_URL`
- `database.js` - ุฅุถุงูุฉ ูุธุงุฆู ูุฅุฏุงุฑุฉ ุฏูุนุงุช CryptAPI
- `index.js` - ุฅุถุงูุฉ endpoints ุฌุฏูุฏุฉ:
  - `POST /api/cryptapi/create-payment` - ุฅูุดุงุก ุนููุงู ุฏูุน
  - `POST /api/cryptapi/callback` - ุงุณุชูุจุงู ุฅุดุนุงุฑุงุช ุงูุฏูุน

## ูุชุบูุฑุงุช ุงูุจูุฆุฉ

### ูุชุบูุฑุงุช ููุฌูุฏุฉ (ูุชู ุงุณุชุฎุฏุงููุง):
- `BOT_WALLET_ADDRESS` - ุนููุงู ูุญูุธุฉ ุงุณุชูุจุงู USDT
- `REPLIT_DOMAINS` - ููุณุชุฎุฏู ูุฅูุดุงุก callback URL ุชููุงุฆููุง

### ูุชุบูุฑุงุช ุงุฎุชูุงุฑูุฉ:
- `CRYPTAPI_CALLBACK_URL` - URL ููู callback (ุงุฎุชูุงุฑูุ ูุชู ุฅูุดุงุคู ุชููุงุฆููุง ูู REPLIT_DOMAINS)

## API Endpoints

### 1. ุฅูุดุงุก ุนููุงู ุฏูุน
```
POST /api/cryptapi/create-payment
```

**Request Body:**
```json
{
  "user_id": 123456789,
  "amount": 10,
  "init_data": "telegram_web_app_data..."
}
```

**Response:**
```json
{
  "success": true,
  "payment": {
    "payment_address": "TXyz123...",
    "qr_code_url": "https://api.cryptapi.io/trc20_usdt/qrcode/...",
    "amount": 10,
    "coin": "trc20_usdt"
  }
}
```

### 2. Callback ูู CryptAPI
```
POST /api/cryptapi/callback
```

ูุณุชูุจู ุงูุจูุงูุงุช ูู CryptAPI ููุนุงูุฌูุง ุชููุงุฆููุง.

**ุงูุฃูุงู:**
- ูุชู ุงูุชุญูู ูู ุชูููุน RSA-SHA256 ูู header `x-ca-signature`
- ูุชู ุฑูุถ ุฃู callback ุจุฏูู ุชูููุน ุตุญูุญ
- ูุญูู ูู ูุฌูุงุช ุชุฒููุฑ ุฅุดุนุงุฑุงุช ุงูุฏูุน

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### Collection ุฌุฏูุฏุฉ: `cryptapi_payments`

```javascript
{
  user_id: Number,
  payment_address: String (unique),
  amount: Number,
  qr_code_url: String,
  callback_url: String,
  status: String, // 'pending', 'confirmed', 'completed'
  created_at: Date,
  tx_id: String,
  confirmations: Number,
  completed_at: Date
}
```

### Indexes:
- `payment_address` (unique)
- `user_id + created_at`
- `status + created_at`

## ุงูุชูุงูู ูุน Web App

ูุชูุนูู ุงููุธุงู ุงูุฌุฏูุฏ ูู Web Appุ ูู ุจุชุนุฏูู ูุงุฌูุฉ ุงูุฅูุฏุงุน ูุชุณุชุฎุฏู ุงูู endpoint ุงูุฌุฏูุฏ:

### ูุซุงู (JavaScript):
```javascript
async function createDeposit(amount) {
  const response = await fetch('/api/cryptapi/create-payment', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      user_id: tg.initDataUnsafe.user.id,
      amount: amount,
      init_data: tg.initData
    })
  });
  
  const data = await response.json();
  
  if (data.success) {
    // ุนุฑุถ ุนููุงู ุงูุฏูุน ู QR code ูููุณุชุฎุฏู
    showPaymentAddress(data.payment.payment_address);
    showQRCode(data.payment.qr_code_url);
  }
}
```

## ุญุงูุฉ ุงููุธุงู

โ **ุชู ุฅุฒุงูุฉ ุงููุธุงู ุงููุฏูู ุชูุงูุงู**

ุชู ุญุฐู ูุธุงู ุงูุฏูุน ุงููุฏูู ุงููุฏูู (ุงูุชุญูู ูู TxID) ุจุงููุงูู. ุงููุธุงู ุงูุขู ูุนุชูุฏ ุจุดูู ูุงูู ุนูู CryptAPI ููุฏูุนุงุช ุงูุชููุงุฆูุฉ.

**ุงููููุงุช ุงููุญุฐููุฉ:**
- โ `tron.js` - ุงูุชุญูู ุงููุฏูู ุงูุฃุณุงุณู ูู ูุนุงููุงุช TRON
- โ `tron-enhanced.js` - ุงูุชุญูู ุงููุญุณูู ูุน retry logic
- โ `payment-worker.js` - ูุนุงูุฌ ุงูุฏูุนุงุช ุงููุฏูู
- โ `payment-queue.js` - ูุธุงู ุงูุทูุงุจูุฑ ุงููุฏูู

**ุงูุชุญุฏูุซุงุช:**
- โ ุชู ุชุญุฏูุซ `index.js` ูุฅุฒุงูุฉ ุฌููุน ูุฑุงุฌุน ุงููุธุงู ุงููุฏูู
- โ ุชู ุชุญุฏูุซ `bot.js` ูุฅุฒุงูุฉ ูุนุงูุฌุฉ ุงูุฅูุฏุงุน ุงููุฏูู
- โ ุชู ุชุญุฏูุซ `monitoring.js` ูุฅุฒุงูุฉ ูุฑุงูุจุฉ ุงูุทูุงุจูุฑ ุงููุฏููุฉ
- โ ุชู ุชุญุฏูุซ Web App (`public/index.html` ู `public/js/app.js`) ูุงุณุชุฎุฏุงู CryptAPI ููุท

## ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุฅูุดุงุก ุนููุงู ุงูุฏูุน:
```bash
curl -X POST https://your-domain.replit.app/api/cryptapi/create-payment \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 123456789,
    "amount": 10,
    "init_data": "your_telegram_init_data"
  }'
```

### 2. ุงุฎุชุจุงุฑ Callback (ููุชุทููุฑ ููุท):
ููููู ุงุณุชุฎุฏุงู ุฃุฏูุงุช ูุซู Postman ููุญุงูุงุฉ callback ูู CryptAPI.

## ุงูุฏุนู

- **CryptAPI Docs**: https://docs.cryptapi.io
- **ุฑุณูู ุงูุฎุฏูุฉ**: 1% ูู ูููุฉ ุงููุนุงููุฉ
- **ุงูุญุฏ ุงูุฃุฏูู ููุฏูุน**: ุญุณุจ ุงูุนููุฉ (USDT TRC-20 ุนุงุฏุฉู 1 USDT)

## ุญุงูุฉ ุงูุชูููุฐ

1. โ ุชู ุชุซุจูุช ุงูููุชุจุฉ ูุฅุนุฏุงุฏ ุงููููุงุช
2. โ ุชู ุฅูุดุงุก endpoints API
3. โ ุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ุชู ุชุญุฏูุซ Web App ุจุงููุงูู ูุงุณุชุฎุฏุงู CryptAPI
5. โ ุชู ุฅุฒุงูุฉ ุงููุธุงู ุงููุฏูู ุจุงููุงูู
6. โ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุนูู ุจุงููุงูู!** ๐

## ุงูุฃูุงู

### ุงูุชุฏุงุจูุฑ ุงูุฃูููุฉ ุงููุทุจูุฉ:

1. **ุงูุชุญูู ูู ุชูููุน CryptAPI (RSA-SHA256)**
   - ูู callback ูุชู ุงูุชุญูู ูู ุชูููุนู ุนุจุฑ header `x-ca-signature`
   - ูุชู ุฌูุจ ุงูููุชุงุญ ุงูุนุงู ูู CryptAPI ูุญูุธู ูู ุงูุฐุงูุฑุฉ (cache ููุฏุฉ 24 ุณุงุนุฉ)
   - ุฃู callback ุจุฏูู ุชูููุน ุตุญูุญ ูุชู ุฑูุถู ููุฑูุง
   - ูุญูู ูู ูุฌูุงุช ุชุฒููุฑ ุฅุดุนุงุฑุงุช ุงูุฏูุน

2. **ุงูุชุญูู ูู Telegram WebApp Data**
   - endpoint `/api/cryptapi/create-payment` ูุชุญูู ูู ุตุญุฉ `init_data`
   - ูุถูู ุฃู ุงูุทูุจ ูุงุฏู ูู Telegram WebApp ุงูุฑุณูู
   - ูููุน ุฅูุดุงุก ุฏูุนุงุช ููููุฉ

3. **ุงูุชุญูู ูู ุญุงูุฉ ุงูุฏูุน**
   - ููุน ูุนุงูุฌุฉ ููุณ ุงูุฏูุน ูุฑุชูู
   - ุงูุชุญูู ูู ุนููุงู ุงูุงุณุชูุจุงู (BOT_WALLET_ADDRESS)
   - ุงูุชุญูู ูู ุงูุญุฏ ุงูุฃุฏูู ูููุจูุบ

4. **Rate Limiting**
   - ุฌููุน API endpoints ูุญููุฉ ุจู rate limiting
   - ูููุน ูุฌูุงุช DDoS ูุงูุทูุจุงุช ุงูููุฑุทุฉ

## ููุงุญุธุงุช ูููุฉ

- ุชุฃูุฏ ูู ุฃู `BOT_WALLET_ADDRESS` ุตุญูุญ ูุชููู ููุงุชูุญู
- CryptAPI ูุญุชุงุฌ ุงููุตูู ุฅูู callback URL (ุชุฃูุฏ ุฃูู ุนุงู ููููู ุงููุตูู ุฅููู)
- ูุชู ุงูุชุญูู ูู ุงูุฏูุนุงุช ุจุนุฏ ุชุฃููุฏ ูุงุญุฏ ุนูู ุงูุฃูู ุนูู blockchain
- ุงููุธุงู ูุฏุนู USDT TRC-20 ููุท ุญุงูููุง (ูููู ุฅุถุงูุฉ ุนููุงุช ุฃุฎุฑู ุจุณูููุฉ)
- **ููู ุฌุฏูุง**: ูุง ุชุดุงุฑู `BOT_WALLET_ADDRESS` private key ูุน ุฃู ุดุฎุต
